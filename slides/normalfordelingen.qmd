---
title: Normalfordelingen
format: 
  revealjs:
    logo: "kubdatalab.png"
    css: webr-custom.css
engine: knitr
filters:
  - webr
---

## Hvad er en sandsynlighedsfordeling?

:::: {.columns}

:::: {.column}
Når vi måler noget får vi som regel en række forskellige resultater. 

Højde af mænd er et eksempel. Nogen er 1,85 meter. Andre 1,80 meter.

Når vi laver et histogram af alle de målinger, kunne det se således ud:
::::
:::: {.column}
```{r hist-male-height, echo = FALSE}
rnorm(1000, mean = 181, sd = 6.5) |> hist(main = "Fordelingen af danske mænds højde", xlab = NULL)
```

Hvad er mest sandsynligt - at være mellem 190 og 195 cm eller at være mellem 180 og 185 cm høj?
::::

::::


## Hvad er en sandsynlighedsfordeling?
En sandsynlighedsfordeling beskriver hvordan vores målinger fordeler sig.

- Hvad er sandsynligheden for at se en observation der ligger under en bestemt værdi?
- Hvad er sandsynligheden for at se en observation der ligger over en bestemt værdi?
- Hvad er sandsynligheden for at se en observation der ligger mellem to forskellige værdier?


## Hvordan kan vi beskrive alle de her observationer?

```{r}
rnorm(50, mean = 181, sd = 6.5) |> round(digits = 1)
```

. . . 

Gennemsnit

. . . 

Standardafvigelse

:::: notes
Vi vil gerne have dem til at sige middelværdi. Og standardafvigelse
::::

## Middelværdi og standardafvigelse

$x$ er vores målinger. $x_i$ er en fancy måde at skrive at der er flere:
$x_1, x_2, x_3, ... x_i$. og vi har ialt $N$ observationer

Middelværdien:
$$\mu = \frac{\sum(x_i)}{N}$$

Standardafvigelsen

$$\sigma = \sqrt{\frac{\sum(x_i - \mu)^2}{N}  }$$

## Hvornår bruger vi græske bogstaver?

Det gør vi når vi kender de "sande" værdier:

Middelværdi: $\mu$. Standardafvigelse: $\sigma$

De latinske bogstaver bruger vi når vi "kun" kender værdierne fra vores stikprøve:

Middelværdi: $\bar{x}$. Standardafvigelse: $s$

:::: notes
Kender vi den sande værdi af gennemsnittet af alle danske mænds højde? Normalt ikke.
::::

## Hvad er normalfordelingen?

Værdierne vi så før var normalfordelte

De fleste eksamensopgaver I støder på, har en formulering om at I kan antage at data er normalfordelte.

Hvad betyder det?

. . .

Undersøger vi hvilken sandsynlighedsfordelinger mange forskellige ting følger

. . . 

Så er den hyppigst forekommende normalfordelingen.

. . . 

Det er den "normale" fordeling

:::: notes
Det er ikke en normativ betegnelse, normal i denne kontekst blot den hyppigst forekommende

::::

## Hvordan ser den ud?

Observationer der er normalfordelte, følger denne fordeling:

$$
f(x) = \frac{1}{\sqrt{2\pi\sigma^2}} e^{-\frac{(x-\mu)^2}{2\sigma^2}}
$$


$f(x)$ er sandsynligheden for at se en observation med værdien x. $\mu$ og $\sigma$ har vi mødt før.

. . . 
 
Det er der jo ingen der orker at arbejde med...

. . . 

Det vigtige er at den 100% styres af $\mu$ og $\sigma$

## Hvordan ser den ud?

```{r normalfordelingen, echo = FALSE}
library(tidyverse)
x <- seq(-4, 4, length.out = 100)

# Normal fordeling
normal <- dnorm(x, mean = 0, sd = 1)
tibble(x = x, y = normal) |> 
  ggplot(aes(x, y = normal)) +
  geom_line()
```

- Her har vi målinger der kan gå fra -4 til 4. 
- Og har $\mu = 0$ og $\sigma = 1$. 
- Arealet under kurven er 1 ~ 100%.
- For alle værdierne er med og sandsynligheden for at vi ser en værdi er 100%

## Standardnormalfordelingen

Når $\mu = 0$ og $\sigma = 1$ kalder vi den for "standardnormalfordelingen".

## Hvilke egenskaber har den?

![](The_Normal_Distribution.svg)

:::: notes

Bemærk at enheden på x-aksen er i "standardafvigelser". 
At den går fra minus uendelig til uendelig
sammenhængen mellem median og middelværdi
Læg også mærke til at z-scores er lig med enheden. T-scores er en normalisering fra psykometrien. Den bruger vi ikke her.

::::

## Fine tal - hvordan finder vi dem selv?

Ifølge den fine graf ligger 15.9% af observationerne under $-1\sigma$. 

Hvordan finder vi selv det tal?

- pnorm
- qnorm


## pnorm

pnorm(x) fortæller hvad sandsynligheden p er for at se en observation der er mindre end x.

```{r echo = TRUE}
pnorm(-1)
```

Vi kan også skrive det som:

P(X < -1) = 0.1586553

## Og omvendt?

Hvis sandsynligheden for at at X er mindre end -1 skrives som:

P(X < -1)

Hvad er så sandsynligheden for at X er større end -1?

. . . 

1 - P(X < -1)

## qnorm

qnorm(p) fortæller os den værdi x, hvor sandsynligheden for at være mindre end x er p. 

```{r echo = TRUE}
qnorm(0.025)
```

For hvilken værdi er 0.025 eller 2.5% af observationerne mindre?

## Eller

- pnorm går fra værdi til sandsynlighed.
- qnorm går fra sandsynlighed til værdi.

P(X < værdi) = sandsynlighed

- Hvis vi ved hvad værdien er, bruger vi pnorm til at beregne sandsynligheden
- Hvis vi ved hvad sandsynligheden er, bruger vi qnorm til at beregne værdien

## Typiske spørgsmål vi får:

Hvis vi har målinger/observationer af et eller andet, kan det være nyttigt at kunne svare på:

1. Hvor mange procent af observationerne er under 0.4?
2. Hvor mange procent af observationerne ligger mellem -2 og 2?
3. De 65.5% mindste observationer; hvad er de mindre end?
4. Indenfor hvilket interval ligger 95.45% af observationerne?

:::: notes
De hænger sammen. 1 og 3 er hinandens omvendte
2 og 4 er også hinandens omvendte

:::: 



## Øvelse 1

:::: {.columns}
:::: {.column}
Hvilken andel af observationerne i standardnormalfordelingen er mindre end -3?

::::notes
Det er en sandsynlighed vi er på jagt efter  så pnorm
::::

::::
:::: {.column}
```{webr-r}
#| context: interactive
#| layout: horizontal
#| autorun: false

```
::::
::::


## Øvelse 2

:::: {.columns}
:::: {.column}
Hvilken andel af observationerne i standardnormalfordelingen er mindre end 2?

::::notes
Det er en sandsynlighed vi er på jagt efter så pnorm
::::

::::
:::: {.column}
```{webr-r}
#| context: interactive
#| layout: horizontal
#| autorun: false

```
::::
::::


## Øvelse 3

:::: {.columns}
:::: {.column}
Hvilken andel af observationerne i standardnormalfordelingen er større end 2?

::::notes
Det er en sandsynlighed vi er på jagt efter så pnorm. Den giver os sandsynligheden for at 
observationerne er mindre end 2. Sandsynligheden for at observationen er, er 1. Så 1-pnorm(2)
::::

::::
:::: {.column}
```{webr-r}
#| context: interactive
#| layout: horizontal
#| autorun: false

```
::::
::::

## Øvelse 4

:::: {.columns}
:::: {.column}
Hvad er 25% af observationerne mindre end?

::::notes
Nu kender vi sandsynligheden, og skal have værdien - qnorm
::::

::::
:::: {.column}
```{webr-r}
#| context: interactive
#| layout: horizontal
#| autorun: false

```
::::
::::


## Øvelse 5

:::: {.columns}
:::: {.column}
Hvad er 40% af observationerne større end?

::::notes
Det svarer til den værdi hvor 60% af observationerne er mindre. så qnorm, men af 0.6
::::

::::
:::: {.column}
```{webr-r}
#| context: interactive
#| layout: horizontal
#| autorun: false

```
::::
::::


## Øvelse 6

:::: {.columns}
:::: {.column}
Hvilken andel af observationerne ligger mellem 1 og 1.5?

::::notes
Vi kender værdierne, og skal bruge sandsynlighederne. Så pnorm.
Sandsynligheden er arealet under kurven fra -uendelig til værdien. Så. Arealet fra -uendelig til 1.5. Minus arealet fra -uendelig til 1, trukket fra, giver os arealet mellem de to punkter
::::

::::
:::: {.column}
```{webr-r}
#| context: interactive
#| layout: horizontal
#| autorun: false

```
::::
::::


## Øvelse 7

:::: {.columns}
:::: {.column}

Hvis vi vil have 47% af observationerne, hvilket interval (centreret om 0) skal vi så have?

::::notes
Det der ligger uden for de 47% er 1 - 0.47 = 0.53. 
Det ligger symmetrisk, så halvdelen på den ene side og den anden halvdel på den anden.

0.53/2 = 0.265

Vi kender sandsynligheden, så vi skal bruge qnorm for at finde værdien

Og er er lige mange på hver side, så det giver os den nedre, den øvre er samme absolutte værdi.

::::

::::
:::: {.column}
```{webr-r}
#| context: interactive
#| layout: horizontal
#| autorun: false

```
::::
::::


## Gennemsnitshøjden er jo ikke 0?!

Det er vældig fint at vi får at vide at vores data er normalfordelte. Det er en del
lettere at regne på en hvis de ikke er.

Det er en del af årsagen til at I får at vide at data er normalfordelte. Det bliver 
noget man faktisk kan regne på i hånden. Og så får man testet om I forstår normalfordelinge.

Men data følger jo ikke standardnormalfordelingen. mu og sigma er ikke hhv 0 og 1.

Hvis bare der var en måde at transformere vores data til at have mu = 0 og sigma =1.

Det er der heldigvis. 

Hvad er gennemsnittet af tallene 1 til 6?

```{r}
mean(1:6)
```

Hvad er gennemsnittet af tallene 1 til 6, efter vi har trukket 3.5 fra?

```{r}
mean(1:6 - 3.5)
```

Hvad er deres standardafvigelse?

```{r}
sd(1:6)
```

Hvad er standardafvigelsen af tallene 1 til 6 hvis vi dividerer dem med standardafvigelsen?

```{r}
sd(1:6/sd(1:6))
```

magi... Eller matematik.

Vi kan godt udlede hvorfor det passer. Nu nøjes vi bare med at konstatere at det gør det.


## Hvad kan vi bruge det til?

Notationen for normalfordelingen er N(mu,sigma)

Hvis mu er 181 og sigma er 6.5

og vi vil vide hvad sandsynligheden er for at være mindre end 170 cm høj.

P(X<170) = P(X< (170 - 181) / 6.5) = -1.692

```{r}
pnorm(-1.692)
```

## Øvelser

Inklusive

For en normalfordelt population ved vi at 50% af værdierne er mindre end 0, og 60% er mindre
end 1. Hvad er middelværdi og spredning?

P(X<0) = 0.5
P(X<1) = 0.6

P((X-mu)/sd < (0-mu)/sd) = 0.5



## Hvorfor er den vigtig?



Normalfordelingen er særligt vigtig på grund af "Den Centrale Grænseværdisætning".

Vi er interesseret i gennemsnitshøjden af danske mænd. Vi ved ikke hvilken sandsynlighedsfordeling der beskriver danske mænds højde.

Så vi tager en stikprøve på eksempelvis 20 mænd fra populationen - alle danske mænd - og måler deres højde.

Så beregner vi gennemsnittet og gemmer det.

Det gentager vi mange gange. Ny stikprøve - mål - beregn gennemsnit. Ny stikprøve - mål - beregn gennemsnit.

Det gør vi mange gange. Så vil de gennemsnit, middelværdierne - følge normalfordelingen. _Uanset_ hvilken sandsynlighedsfordeling danske mænds højde følger.

Det kan man føre bevis for. Hvis I kan forstå det bevis, skulle I have læst matematik i stedet for medicin. Så det springer vi over.

## Hvorfor er den vigtig for jer?

Ret ofte er der en typeopgave der grundlæggende tester om I forstår normalfordelingen. 

Og så bruges den i de statistiske tests

## normalisering/skalering

Normalfordelingen er normalt standardiseret. Den har middelværdi 0 og standardafvigelse 1.

Det har vores data normalt _ikke_. Hvad gør vi så?

Vi skalerer vores data. Hvis vi har en række observationer, der har en bestemt middelværdi, og trækker den 
middelværdi fra alle observationerne - hvad er så den nye middelværdi? 0.

Hvis vi dividerer alle observationerne med sigma - hvad er så den nye standardafvigelse? Den er 1.

Så har vi nu en række observationer med middelværdi 0 og standardafvigelse 1. Det er ikke det samme som at de 
er normalfordelte

```{r}
sd(c(rep(5, 10), rep(-5,10))/5.129892)
```

se også scale funktionen

forskellen på X-bar og mu

pnorm, qnorm

## Logaritmering

Ud over skalering af data er der en anden skalering eller transformation vi ofte foretager - logaritmering.

Ting der ikke er normalfordelte bliver det ofte hvis man tager logaritmen til dem.


## Eksamen

Der er ofte en opgave hvor I får oplyst nogen egenskaber ved en stikprøve.

Ud fra de egenskaber skal I svare på spørgsmål om hvad vi kan fortælle om populationen - eller stikprøven - ud fra disse egenskaber.






## Det er en sandsynlighedsfordeling. Hvad er det?

Når vi undersøger et eller andet der kan have forskellige værdier, viser det sig 
at disse forskellige værdier optræder med forskellig sandsynlighed. Der er måler
der ses oftere end andre. I kommer til at se flere systoliske blodtryk omkring 120 mmHg,
end omkring 200 mmHg. (eller... I kommer nok ikke til at se så mange patienter der klager over at have et normalt blodtryk).

De her sandsynligheder kan fordele sig forskelligt, afhængig af hvad der egentlig styrer 
hvordan værdierne egentlig opstår. Så de kan se forskellige ud:

```{r 4-distibutions, echo  =F, fig.width=5, fig.height=5 }
# Generer data
library(tidyverse)
x <- seq(-4, 4, length.out = 100)

# Normal fordeling
normal <- dnorm(x, mean = 0, sd = 1)

# Student's t-fordeling med 3 frihedsgrader
student_t <- dt(x, df = 3)

# Chi-squared fordeling (forskudt til at passe bedre i plottet)
chi_sq <- dchisq(x + 2, df = 3)

# F-fordeling (også forskudt)
f_dist <- df(x + 2, df1 = 3, df2 = 10)

# Kombiner data
plot_data <- data.frame(x = x,
                        Normal = normal,
                        Student_t = student_t,
                        Chi_squared = chi_sq,
                        F_distribution = f_dist) |> 
  pivot_longer(-x, names_to = "Distribution", values_to = "Density")

# Lav plot med facetter
ggplot(plot_data, aes(x = x, y = Density)) +
  geom_line(linewidth = 1, colour = "steelblue") +
  facet_wrap(~Distribution, ncol = 2, scales = "free_y") +
  theme_minimal() +
  labs(title = "Four different probability distributions",
       x = "x",
       y = "Density") +
  theme(plot.title = element_text(hjust = 0.5))
```

Afhængig af den konkrete fordeling, er det forskellige ting der styrer dens udseende. 
Det de har til fælles er at arealet under kurven er 1. 1 svarer til 100%. Og når
sandsynlighedsfordelingen beskriver sandsynligheden for alle mulige værdier, så er 
den samlede sandsynlighed 100%

Normalfordelingen styres af værdiernes middelværdi, og deres standardafvigelse.



## Og hvad når mine data ikke har en middelværdi på 0?

Jamen så normerer vi. 

Lad os tage nogen mere eller mindre tilfældige tal:


```{r}
exempel <- c(1,5,7,0,42,10,11,2)
(middel <- mean(exempel))
(sd_afv <- sd(exempel))
```

Så kan vi trække middelværdien fra alle tallene

```{r}
norm_middel <- exempel - middel
mean(norm_middel)
```

Standardafvigelsen er stadig ikke 0:


```{r}
(stdafv <- sd(norm_middel))



```

Men hvis vi dividerer tallene med standardafvigelsen:
```{r}
norm_middel_stdafv <- norm_middel/stdafv
mean(norm_middel_stdafv)
sd(norm_middel_stdafv)
```

Så har vi såkaldt normerede værdier, eller skalerede om man vil.

Og deres middelværdi er 0 (eller så tæt på at vi ikke kan se forskel)
Og deres standardafvigelse er 1.

Så kan vi bruge pnorm og de andre funktioner. Og når vi skal tilbage til de oprindelige tal - så ganger vi med den oprindelige standardafvigelse, og lægger den oprindelige middelværdi til.

Alternativt bruger vi et trick i pnorm/qnorm:


```{r}
pnorm(1.96, mean = 9.75, sd = 13.64604)
```

## Hvordan gør man det lidt kortere?

Den standardiserede normalfordeling er $N(0, 1)$

Den fordeling vi som regel får er ikke standardiseret, men har formen:

$X(\bar{X},s)$ (skal det været et lille x et sted?)

Og vi vil som regel skrive at  $X(\bar{X},s) \sim N(\mu, \sigma)$ 

Altså at vores fordeling X (som er beskrevet af middelværdi og spredning) er ækvivalent med den standardiserede normalfordeling med 

Der er en modelløsning der vil være fin her.

og så omregningen...





## Øvelse

Hvis vi har en population med normalfordelte værdier der har en spredning på 
$\sigma = 6.52$ og 40% af værdierne er mindre end 0. Hvad er så middelværdien for
denne fordeling?

Vi ved ikke hvad middelværdien er. Men vi ved at standardafvigelsen er 6.52.

Så den er ikke normaliseret/skaleret. 

vores fordeling kalder vi for X. den er en normalfordeling N(mu, 6.52)

Så det skal nævnes, at notationen er N(mu, sd)

Vi er på jagt efter P(X<0) = 0.4

Det skal vi have normeret/skaleret:

P((X-mu)/6.52 < (0-mu)/6.52) = 0.4


```{r}
qnorm(0.4)
```

For at transformere vores værdier, skal vi trække \mu fra, og dividere med 
standardafvigelsen.

Det gælder også den 0 værdi vi leder efter

(0-mu)/sd


Yderligere øvelser
For en population af normalfordelte værdier ved vi at 50% af værdierne er mindre end 0.
Og at 60% af værdierne er mindre end 1. Hvad er middelværdi og spredning for den 
population?

Vi skal tidligere have nævnt medianen og sammenhængen mellem den og gennemsnittet i normalfordelinger

Der skal bruges lidt flere ord på beskrivelsen af fordelingen.
altså mere generelt at en fordeling X~N(mu,sigma) kan transformeres til 
(X-mu)/sigma.


Og så yderligere en række øvelser. Typeopgaverne her er tests af om man forstår normalfordelingen, og kan regne på den.


Opgave 1 - Manglende procentil:
quartoEn normalfordelt population har middelværdi $\mu = 12.5$ og 
standardafvigelse $\sigma = 3.2$. Hvor stor en andel af værdierne 
er mindre end 10?
Opgave 2 - Manglende standardafvigelse:
quartoI en normalfordelt population er middelværdien $\mu = 85$ og 
25% af værdierne er større end 95. Hvad er standardafvigelsen 
$\sigma$ for denne fordeling?
Opgave 3 - Manglende værdi ved given procentil:
quartoEn normalfordelt variabel har middelværdi $\mu = 50$ og 
standardafvigelse $\sigma = 8$. Hvilken værdi $x$ er der tale om, 
hvis 90% af observationerne er mindre end denne værdi?
Opgave 4 - Manglende middelværdi (anden variant):
quartoFor en normalfordeling gælder det at $\sigma = 4.5$ og at 75% af 
værdierne er mindre end 18. Hvad er middelværdien $\mu$?
Opgave 5 - Manglende interval-grænse:
quartoEn normalfordelt population har $\mu = 100$ og $\sigma = 15$. 
Hvis 80% af værdierne ligger mellem 85 og en øvre grænse $x$, 
hvad er da denne øvre grænse?
Alle opgaver kan løses ved at kombinere normalfordelingens egenskaber med z-scores og standardnormaltabellen.
